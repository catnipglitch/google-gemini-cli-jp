# チェックポイント機能 (Checkpointing)

Gemini CLI には、AI ツールによってファイル変更が行われる前に、プロジェクトの状態のスナップショットを自動的に保存するチェックポイント機能が含まれています。これにより、ツールを実行する前の状態に即座に戻すことができるため、安全にコード変更を試したり適用したりできます。

## 仕組み

ファイルシステムを変更するツール（`write_file` や `replace` など）を承認すると、CLI は自動的に「チェックポイント」を作成します。このチェックポイントには以下が含まれます：

1.  **Git スナップショット:** ホームディレクトリ（`~/.gemini/history/<project_hash>`）にある特別な「シャドウ Git リポジトリ」にコミットが作成されます。このスナップショットは、その時点でのプロジェクトファイルの完全な状態をキャプチャします。これは、あなた自身のプロジェクトの Git リポジトリには**干渉しません**。
2.  **会話履歴:** その時点までのエージェントとのすべての会話が保存されます。
3.  **ツール呼び出し:** 実行されようとしていた特定のツール呼び出しも保存されます。

変更を元に戻したい場合、または単に戻りたい場合は、`/restore` コマンドを使用できます。チェックポイントを復元すると、次のようになります：

- プロジェクト内のすべてのファイルを、スナップショットにキャプチャされた状態に戻します。
- CLI 内の会話履歴を復元します。
- 元のツール呼び出しを再度提案し、再実行、修正、または無視できるようにします。

Git スナップショットや会話履歴を含むすべてのチェックポイントデータは、ローカルマシンに保存されます。Git スナップショットはシャドウリポジトリに保存され、会話履歴とツール呼び出しはプロジェクトの一時ディレクトリ（通常は `~/.gemini/tmp/<project_hash>/checkpoints`）にある JSON ファイルに保存されます。

## 機能の有効化

チェックポイント機能はデフォルトで無効になっています。有効にするには、`settings.json` ファイルを編集する必要があります。

> **注意:** `--checkpointing` コマンドラインフラグはバージョン 0.11.0 で削除されました。チェックポイント機能は、`settings.json` 設定ファイルを介してのみ有効にできるようになりました。

`settings.json` に次のキーを追加します：

```json
{
  "general": {
    "checkpointing": {
      "enabled": true
    }
  }
}
```

## `/restore` コマンドの使用

有効にすると、チェックポイントは自動的に作成されます。これらを管理するには、`/restore` コマンドを使用します。

### 利用可能なチェックポイントの一覧表示

現在のプロジェクトで保存されているすべてのチェックポイントのリストを表示するには、単に以下を実行します：

```
/restore
```

CLI は、利用可能なチェックポイントファイルの一覧を表示します。これらのファイル名は通常、タイムスタンプ、変更されるファイル名、実行されようとしていたツール名で構成されています（例：`2025-06-22T10-00-00_000Z-my-file.txt-write_file`）。

### 特定のチェックポイントの復元

プロジェクトを特定のチェックポイントに復元するには、リストにあるチェックポイントファイルを使用します：

```
/restore <checkpoint_file>
```

例：

```
/restore 2025-06-22T10-00-00_000Z-my-file.txt-write_file
```

コマンドを実行すると、ファイルと会話はチェックポイントが作成されたときの状態に即座に復元され、元のツールプロンプトが再表示されます。