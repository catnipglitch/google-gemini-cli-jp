# リリース信頼戦略

このドキュメントは、Gemini CLI のすべてのリリースに対する信頼を得るための戦略を概説します。リリース管理者が高品質な製品を出荷することを保証するためのチェックリストと品質ゲートとして機能します。

## 目標

「このリリースは、ユーザーにとって**本当に**準備ができていますか？」という問いに、自動化されたシグナル、手動検証、およびデータの総合的な評価に基づいて、高い信頼度で答えること。

## レベル1: 自動ゲート (パス必須)

これらは基本的な要件です。これらのいずれかが失敗した場合、リリースは中止されます。

### 1. CI/CD ヘルス

`.github/workflows/ci.yml` 内のすべてのワークフローは、`main` ブランチ（ナイトリー用）またはリリースブランチ（プレビュー/安定版用）でパスする必要があります。

- **プラットフォーム:** テストは **Linux および macOS** でパスする必要があります。
  - _注:_ Windows テストは現在 `continue-on-error: true` で実行されています。ここでの失敗は技術的にはリリースをブロックしませんが、調査する必要があります。
- **チェック:**
  - **リンティング:** リンティングエラーがないこと（ESLint、Prettier など）。
  - **タイプチェック:** TypeScript エラーがないこと。
  - **単体テスト:** `packages/core` および `packages/cli` 内のすべての単体テストがパスすること。
  - **ビルド:** プロジェクトが正常にビルドおよびバンドルされること。

### 2. エンドツーエンド (E2E) テスト

`.github/workflows/e2e.yml` 内のすべてのワークフローがパスする必要があります。

- **プラットフォーム:** **Linux、macOS、および Windows**。
- **サンドボックス:** テストは、Linux で `sandbox:none` と `sandbox:docker` の両方でパスする必要があります。

### 3. デプロイ後のスモークテスト

リリースが npm に公開された後、`smoke-test.yml` ワークフローが実行されます。パッケージがインストール可能でバイナリが実行可能であることを確認するために、これがパスする必要があります。

- **コマンド:** `npx -y @google/gemini-cli@<tag> --version` がエラーなしで正しいバージョンを返す必要があります。
- **プラットフォーム:** 現在 `ubuntu-latest` で実行されます。

## レベル2: 手動検証とドッグフーディング

自動テストではすべてを捕捉することはできません。特に UX の問題は捕捉できません。

### 1. `preview` タグによるドッグフーディング

毎週のリリースサイクルは、`main` -> `nightly` -> `preview`
-> `stable` の順でコードをプロモーションします。

- **要件:** `preview` リリースは、`stable` にプロモーションされる前に、メンテナーによって少なくとも**1週間**使用される必要があります。
- **アクション:** メンテナーはプレビューバージョンをローカルにインストールする必要があります。
  ```bash
  npm install -g @google/gemini-cli@preview
  ```
- **目標:** 広範なユーザーベースに到達する前に、日々の使用における回帰や UX の問題を捕捉すること。

### 2. 重要なユーザー体験 (CUJ) チェックリスト

`preview` リリースを `stable` にプロモーションする前に、リリース管理者はこのチェックリストを手動で実行する必要があります。

- **セットアップ:**
  - [ ] 既存のグローバルバージョンをアンインストールします:
        `npm uninstall -g @google/gemini-cli`
  - [ ] npx キャッシュをクリアします（オプションですが推奨）: `npm cache clean --force`
  - [ ] プレビューバージョンをインストールします: `npm install -g @google/gemini-cli@preview`
  - [ ] バージョンを確認します: `gemini --version`

- **認証:**
  - [ ] インタラクティブモードで `/auth` を実行し、すべてのログインフローが機能することを確認します。
    - [ ] Googleでログイン
    - [ ] APIキー
    - [ ] Vertex AI

- **基本的なプロンプト:**
  - [ ] `gemini "Tell me a joke"` を実行し、適切な応答が返されることを確認します。
  - [ ] インタラクティブモードで実行します: `gemini`。コンテキストをテストするために、フォローアップの質問をします。

- **パイプ入力:**
  - [ ] `echo "Summarize this" | gemini` を実行し、標準入力を処理することを確認します。

- **コンテキスト管理:**
  - [ ] インタラクティブモードで、`@file` を使用してローカルファイルをコンテキストに追加します。それについて質問します。

- **設定:**
  - [ ] インタラクティブモードで `/settings` を実行し、変更を行います。
  - [ ] 設定が変更されたことを検証します。

- **関数呼び出し:**
  - [ ] インタラクティブモードで、gemini に「create a file named hello.md with the content 'hello world'」と依頼し、ファイルが正しく作成されることを確認します。

これらの CUJ のいずれかが失敗した場合、`preview` チャネルにパッチが適用されるまで、リリースは中止されます。

### 3. リリース前バグバッシュ (Tier 1 および 2 リリース)

影響の大きいリリースの場合、より高い品質レベルを確保し、幅広い環境とユースケースで問題を捕捉するために、組織的なバグバッシュが必要です。

**ティアの定義:**

- **ティア1:** 業界を動かすニュース 🚀
- **ティア2:** ユーザーにとって重要なニュース 📣
- **ティア3:** 関連性はあるが、人生を変えるほどではない 💡
- **ティア4:** バグ修正 ⚒️

**要件:**

ティア1またはティア2のリリースに先立って、少なくとも**72時間前**にバグバッシュをスケジュールする必要があります。

**経験則:**

以下のいずれかを含むリリースでは、バグバッシュを検討する必要があります。

- ブログ投稿
- 連携したソーシャルメディアでの発表
- メディアリレーションまたはプレス広報
- 「ターボ」ローンチイベント

## レベル3: テレメトリとデータレビュー

### ダッシュボードのヘルス

- [ ] `go/gemini-cli-dash` にアクセスします。
- [ ] 「Tool Call」タブに移動します。
- [ ] プロモーションしたいリリースにエラーの急増がないことを確認します。

### モデル評価

- [ ] `go/gemini-cli-offline-evals-dash` に移動します。
- [ ] プロモーションしたいリリースの定期実行が平均評価実行内であることを確認します。

## 「GO/NO-GO」の決定

`Release: Promote` ワークフローをトリガーして `preview` を `stable` に移動する前に:

1.  [ ] **レベル1:** 現在の `preview` タグに対応するコミットの CI および E2E ワークフローが緑色であることを確認します。
2.  [ ] **レベル2:** `preview` バージョンが1週間公開されており、CUJ チェックリストがリリースマネージャーによって正常に完了していることを確認します。ブロックしている問題は報告されていません。
3.  [ ] **レベル3:** ダッシュボードヘルスとモデル評価のチェックが完了しており、回帰がないことを確認します。

すべてのチェックがパスした場合、プロモーションに進みます。