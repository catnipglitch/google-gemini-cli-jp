# Gemini CLI アーキテクチャ概要

このドキュメントは、Gemini CLI のアーキテクチャの概要を説明します。

## コアコンポーネント

Gemini CLI は、主に2つの主要なパッケージと、コマンドライン入力の処理中にシステムが使用できる一連のツールで構成されています。

1.  **CLI パッケージ (`packages/cli`):**
    - **目的:** これは Gemini CLI のユーザー向け部分であり、初期ユーザー入力の処理、最終出力の表示、全体的なユーザー体験の管理などを行います。
    - **パッケージに含まれる主要機能:**
      - [入力処理](/docs_j/cli/commands.md)
      - 履歴管理
      - ディスプレイレンダリング
      - [テーマとUIのカスタマイズ](/docs_j/cli/themes.md)
      - [CLI設定](/docs_j/get-started/configuration.md)

2.  **コアパッケージ (`packages/core`):**
    - **目的:** これは Gemini CLI のバックエンドとして機能します。`packages/cli` から送信されたリクエストを受信し、Gemini API との対話をオーケストレーションし、利用可能なツールの実行を管理します。
    - **パッケージに含まれる主要機能:**
      - Google Gemini API と通信するための API クライアント
      - プロンプトの構築と管理
      - ツールの登録と実行ロジック
      - 会話またはセッションの状態管理
      - サーバーサイド設定

3.  **ツール (`packages/core/src/tools/`):**
    - **目的:** これらは、Gemini モデルの機能を拡張する個別のモジュールであり、ローカル環境（例: ファイルシステム、シェルコマンド、ウェブフェッチ）と対話することを可能にします。
    - **対話:** `packages/core` は、Gemini モデルからのリクエストに基づいてこれらのツールを呼び出します。

## 対話フロー

Gemini CLI との典型的な対話は、次のフローに従います。

1.  **ユーザー入力:** ユーザーはターミナルにプロンプトまたはコマンドを入力し、これは `packages/cli` によって管理されます。
2.  **コアへのリクエスト:** `packages/cli` はユーザーの入力を `packages/core` に送信します。
3.  **リクエスト処理:** コアパッケージは次を行います。
    - 会話履歴や利用可能なツール定義を含む、Gemini API に適切なプロンプトを構築します。
    - Gemini API にプロンプトを送信します。
4.  **Gemini API 応答:** Gemini API はプロンプトを処理し、応答を返します。この応答は、直接の回答である場合もあれば、利用可能なツールのいずれかを使用するリクエストである場合もあります。
5.  **ツール実行 (該当する場合):**
    - Gemini API がツールを要求すると、コアパッケージはそれを実行する準備をします。
    - 要求されたツールがファイルシステムを変更したり、シェルコマンドを実行したりできる場合、ユーザーにはまずツールの詳細とその引数が提供され、ユーザーは実行を承認する必要があります。
    - ファイルの読み取りなど、読み取り専用の操作では、進行するために明示的なユーザー確認を必要としない場合があります。
    - 確認済みの場合、または確認が不要な場合、コアパッケージは関連するツール内で関連するアクションを実行し、その結果はコアパッケージによって Gemini API に送り返されます。
    - Gemini API はツール結果を処理し、最終応答を生成します。
6.  **CLI への応答:** コアパッケージは最終応答を CLI パッケージに送り返します。
7.  **ユーザーへの表示:** CLI パッケージは応答をフォーマットし、ターミナルに表示します。

## 主要な設計原則

- **モジュール性:** CLI (フロントエンド) とコア (バックエンド) を分離することで、独立した開発と将来的な拡張（例: 同じバックエンドに対する異なるフロントエンド）が可能になります。
- **拡張性:** ツールシステムは拡張可能に設計されており、新しい機能を追加できます。
- **ユーザー体験:** CLI は、リッチでインタラクティブなターミナル体験を提供することに重点を置いています。