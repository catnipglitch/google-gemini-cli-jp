# AI エージェント運用ガイドライン

このドキュメントは、各AIエージェントの定義ファイルに反映するための**マスターガイドライン**です。
ここでは人間が読みやすい形式を維持します。
実際の運用において、この内容は各AIモデル（LLM）やエージェントの特性に合わせて、理解しやすい表現・言語・構成にて各定義ファイルへ適用されます。

*   Gemini -> `GEMINI.md`
*   Codex -> `AGENTS.md` (または `.github/copilot-instructions.md` 等)
*   Claude -> `CLAUDE.md`

## 1. ドキュメント管理システム

開発プロセスは、以下の3つのドキュメントを用いたフローで管理される。

### 1-1. FEATURES.md (アイデア & 要望)
- **目的**: 開発の「入口」。ユーザーのアイデア、機能要望、バグ報告、TODOをストックする場所。
- **運用**:
  - ユーザーからの指示、またはエージェントが気づいたアイデアを記録する。
  - ここに書かれた内容が、タスク実行のトリガーとなる。
  - 優先度の低い項目や将来的な拡張構想もここに記録する。

### 1-2. PRD.md (製品要件定義書)
- **目的**: 開発の「仕様」。Gemini (エージェント) によって記述される仕様書。
- **運用**:
  - **Plan Mode** での議論を経て、仕様が固まったタイミングで更新する。
  - `FEATURES.md` のアイデアを、具体的な実装仕様へ落とし込む。
  - 特定のフォーマットは設けないが、必要に応じて構造化して記述する。
- **連携**: `FEATURES.md` (Idea) → `PRD.md` (Spec) → 実装 (Impl) の流れの中核を担う。

### 1-3. AGENT_TASK_LIST.md (タスク可視化 & 状態共有)
- **目的**:
  - ユーザーおよびチーム全体に対する「現在の状態」と「進捗」の可視化。
  - エージェントの内部エラーやセッション切断時における、進捗状況の把握と復旧の補助。
  - **注記**: これはエージェントが内部的に持つ思考プロセスや短期メモリ（プラン管理）を完全に代替するものではなく、あくまでユーザーおよび他のエージェントとの「外部共有用」および「永続化用」のチェックポイントである。Gemini, Claude, Codex, GitHub Copilot など、異なるAIエージェントが交代で作業する場合のコンテキスト共有に利用する。
- **運用ルール**:
  - **タスクID**: 各タスクには必ず**重複しないインデックス（ID）**を付与する。（例: `[T-001]`, `[TASK-10]` など一貫性を持たせること）
  - **更新タイミング**: `PRD.md` 更新後や、新たな作業が発生した際、およびタスク完了時に更新する。
  - **行数制限**: ファイルサイズが**100行**を超えた場合、完了済みタスクの削除（アーカイブ）についてユーザーに確認を求めること。
    - **禁止事項**: エージェント判断で勝手に過去ログを削除してはならない。
  - **タスク粒度**: ファイル書き込みコストと手数を最小化するため、変数名の修正やインデント調整などの「マイクロタスク」はいちいち記述しないこと。「機能の実装完了」「テストのパス」「主要なバグの修正」など、進捗として意味のある**マイルストーン単位**でタスクを定義・管理する。

---

## 2. オペレーションモード (Operation Modes)

エージェントは以下の2つのモードを厳密に遵守して行動する。
**デフォルトは「Plan Mode」である。**

### 2-1. Plan Mode (計画モード) - Default
- **目的**: 対話、計画策定、要件定義、ドキュメント作成。
- **制約**:
  - **コーディング禁止**: コードの生成や修正は行わない。
  - **ドキュメント編集許可**: `.md` や `.txt` ファイルの作成・編集は許可される。
- **要件**:
  - **明確化 (Clarify)**: タスク着手前に不明点を質問し、要件を明確にする。
  - **評価 (Evaluate)**: 複雑なタスクや設計については、効率性や安全性を疑い、少なくとも2つの代替案（プランA、プランBなど）を提示する。
- **例外**: 画像生成コマンド（`/generate` 等）が指示された場合は、即座にツールを実行する。
- **出力**: 会話の最後は必ず `<Plan Mode>` で締めくくる。

### 2-2. Edit Mode (実装モード)
- **目的**: 実装、コーディング。
- **制約**:
  - コードの生成、修正が許可される。
  - 通常のエージェントとしての振る舞いが適用される。
- **モード切替**:
  - **ユーザー指示**: ユーザーから「Edit Modeへ切り替え」等の明確な指示があった場合。
  - **エージェント宣言**: エージェントが「プランAで進めます。Edit Modeへ切り替えます」と宣言し、ユーザーの同意を得た場合。
