# セッション管理

Gemini CLI には、会話履歴を自動的に保存する堅牢なセッション管理機能が含まれています。これにより、作業を中断して中断した場所から正確に再開したり、過去のやり取りを確認したり、会話履歴を効果的に管理したりできます。

## 自動保存

Gemini CLI と対話するたびに、セッションは自動的に保存されます。これは手動で操作することなくバックグラウンドで行われます。

- **保存される内容:** 完全な会話履歴。以下が含まれます。
  - あなたのプロンプトとモデルの応答。
  - すべてのツール実行（入力と出力）。
  - トークン使用統計（入力/出力/キャッシュなど）。
  - アシスタントの思考/推論の概要（利用可能な場合）。
- **場所:** セッションは `~/.gemini/tmp/<project_hash>/chats/` に保存されます。
- **スコープ:** セッションはプロジェクト固有です。別のプロジェクトのディレクトリに切り替えると、そのプロジェクトのセッション履歴に切り替わります。

## セッションの再開

以前のセッションを再開して、すべての以前のコンテキストを復元した状態で会話を続行できます。

### コマンドラインから

CLI を起動するときに、`--resume`（または `-r`）フラグを使用できます。

- **最新を再開:**

  ```bash
  gemini --resume
  ```

  これにより、最新のセッションがすぐにロードされます。

- **インデックスで再開:** まず、利用可能なセッションを一覧表示し（[セッションの一覧表示](#セッションの一覧表示)を参照）、次にインデックス番号を使用します。

  ```bash
  gemini --resume 1
  ```

- **ID で再開:** 完全なセッション UUID を指定することもできます。
  ```bash
  gemini --resume a1b2c3d4-e5f6-7890-abcd-ef1234567890
  ```

### 対話型インターフェースから

CLI の実行中に、`/resume` スラッシュコマンドを使用して**セッションブラウザ**を開くことができます。

```text
/resume
```

これにより、次のことができる対話型インターフェースが開きます。

- **参照:** 過去のセッションのリストをスクロールします。
- **プレビュー:** セッションの日付、メッセージ数、最初のユーザープロンプトなどの詳細を確認します。
- **検索:** `/` を押して検索モードに入り、ID またはコンテンツでセッションをフィルタリングするためにタイプします。
- **選択:** `Enter` を押して、選択したセッションを再開します。

## セッションの管理

### セッションの一覧表示

現在のプロジェクトで利用可能なすべてのセッションのリストをコマンドラインから表示するには:

```bash
gemini --list-sessions
```

出力例:

```text
Available sessions for this project (3):

  1. Fix bug in auth (2 days ago) [a1b2c3d4]
  2. Refactor database schema (5 hours ago) [e5f67890]
  3. Update documentation (Just now) [abcd1234]
```

### セッションの削除

古いセッションや不要なセッションを削除して、スペースを解放したり、履歴を整理したりできます。

**コマンドラインから:** インデックスまたは ID を指定して `--delete-session` フラグを使用します。

```bash
gemini --delete-session 2
```

**セッションブラウザから:**

1.  `/resume` でブラウザを開きます。
2.  削除したいセッションに移動します。
3.  `x` を押します。

## 設定

`settings.json` ファイルで、Gemini CLI がセッション履歴を管理する方法を構成できます。

### セッション保持

履歴が無制限に増大するのを防ぐために、自動クリーンアップポリシーを有効にできます。

```json
{
  "general": {
    "sessionRetention": {
      "enabled": true,
      "maxAge": "30d", // 30日間セッションを保持
      "maxCount": 50 // 最新の50セッションを保持
    }
  }
}
```

- **`enabled`**: (boolean) セッションクリーンアップのマスター切り替え。デフォルトは `false` です。
- **`maxAge`**: (string) セッションを保持する期間（例: "24h"、"7d"、"4w"）。これよりも古いセッションは削除されます。
- **`maxCount`**: (number) 保持するセッションの最大数。この数を超える最も古いセッションは削除されます。
- **`minRetention`**: (string) 最小保持期間（安全限界）。デフォルトは `"1d"` です。この期間よりも新しいセッションは自動クリーンアップによって削除されることはありません。

### セッション制限

個々のセッションの長さを制限して、コンテキストウィンドウが大きくなりすぎてコストが高くなるのを防ぐこともできます。

```json
{
  "model": {
    "maxSessionTurns": 100
  }
}
```

- **`maxSessionTurns`**: (number) 1つのセッションで許可されるターン数（ユーザー + モデルのやり取り）の最大値。無制限の場合は `-1` に設定します（デフォルト）。

  **制限に達した場合の動作:**
  - **対話型モード:** CLI は情報メッセージを表示し、モデルへのリクエストの送信を停止します。新しいセッションを手動で開始する必要があります。
  - **非対話型モード:** CLI はエラーで終了します。