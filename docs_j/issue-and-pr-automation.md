# 自動化とトリアージプロセス

このドキュメントでは、Issue とプルリクエストを管理およびトリアージするために使用する自動化されたプロセスについて詳しく説明します。私たちの目標は、迅速なフィードバックを提供し、貢献が効率的にレビューされ、統合されることを保証することです。この自動化を理解することで、コントリビューターは、何が期待され、リポジトリボットとどのように最適にやり取りできるかを知ることができます。

## 指導原則: Issue とプルリクエスト

まず第一に、ほとんどすべてのプルリクエスト (PR) は、対応する Issue にリンクされている必要があります。Issue は「何を」「なぜ」（バグまたは機能）を記述し、PR は「どのように」（実装）を記述します。この分離は、作業の追跡、機能の優先順位付け、明確な履歴コンテキストの維持に役立ちます。私たちの自動化はこの原則に基づいて構築されています。

---

## 詳細な自動化ワークフロー

以下に、リポジリで実行される特定の自動化ワークフローの内訳を示します。

### 1. Issue を開いたとき: `Automated Issue Triage`

これは、Issue を作成したときに最初にやり取りするボットです。その仕事は、初期分析を実行し、正しいラベルを適用することです。

- **ワークフローファイル**: `.github/workflows/gemini-automated-issue-triage.yml`
- **実行タイミング**: Issue が作成または再オープンされた直後。
- **機能**:
  - Gemini モデルを使用して、Issue のタイトルと本文を詳細なガイドラインセットに対して分析します。
  - **`area/*` ラベルを1つ適用します**: Issue をプロジェクトの機能領域（例: `area/ux`、`area/models`、`area/platform`）に分類します。
  - **`kind/*` ラベルを1つ適用します**: Issue の種類（例: `kind/bug`、`kind/enhancement`、`kind/question`）を識別します。
  - **`priority/*` ラベルを1つ適用します**: 記述された影響に基づいて、P0（重要）からP3（低）までの優先順位を割り当てます。
  - **`status/need-information` を適用する場合があります**: Issue に重要な詳細（ログや再現手順など）が不足している場合、より多くの情報を必要とするとフラグが立てられます。
  - **`status/need-retesting` を適用する場合があります**: Issue が6バージョン以上前の CLI バージョンを参照している場合、現在のバージョンでの再テストが必要であるとフラグが立てられます。
- **実行すべきこと**:
  - Issue テンプレートを可能な限り完全に記入してください。提供する詳細が多いほど、トリアージはより正確になります。
  - `status/need-information` ラベルが追加された場合は、コメントで要求された詳細を提供してください。

### 2. プルリクエストを開いたとき: `Continuous Integration (CI)`

このワークフローは、すべての変更がマージされる前に品質基準を満たしていることを保証します。

- **ワークフローファイル**: `.github/workflows/ci.yml`
- **実行タイミング**: プルリクエストへのすべてのプッシュ時。
- **機能**:
  - **Lint**: コードがプロジェクトのフォーマットおよびスタイルルールに準拠していることを確認します。
  - **Test**: macOS、Windows、Linux、および複数の Node.js バージョンで自動テストスイート全体を実行します。これは CI プロセスで最も時間のかかる部分です。
  - **Post Coverage Comment**: すべてのテストが正常にパスした後、ボットは PR にコメントを投稿します。このコメントは、変更がテストによってどれだけ適切にカバーされているかを示します。
- **実行すべきこと**:
  - すべての CI チェックがパスしていることを確認してください。すべてが成功すると、コミットの横に緑色のチェックマーク ✅ が表示されます。
  - チェックが失敗した場合（赤色の「X」❌）、失敗したチェックの横にある「Details」リンクをクリックしてログを表示し、問題を特定して修正をプッシュしてください。

### 3. プルリクエストの継続的なトリアージ: `PR Auditing and Label Sync`

このワークフローは定期的に実行され、すべてのオープン PR が Issue に正しくリンクされ、一貫したラベルを持っていることを保証します。

- **ワークフローファイル**: `.github/workflows/gemini-scheduled-pr-triage.yml`
- **実行タイミング**: すべてのオープンなプルリクエストに対して15分ごとに実行されます。
- **機能**:
  - **リンクされた Issue の確認**: ボットは、Issue にリンクするキーワード（例: `Fixes #123`、`Closes #456`）を PR の説明でスキャンします。
  - **`status/need-issue` の追加**: リンクされた Issue が見つからない場合、ボットは PR に `status/need-issue` ラベルを追加します。これは、Issue を作成してリンクする必要があることを明確に示すシグナルです。
  - **ラベルの同期**: Issue がリンクされている場合、ボットは PR のラベルが Issue のラベルと完全に一致することを確認します。不足しているラベルを追加し、属していないラベルを削除し、`status/need-issue` ラベルが存在する場合は削除します。
- **実行すべきこと**:
  - **常に PR を Issue にリンクしてください。** これは最も重要なステップです。PR の説明に `Resolves #<issue-number>` のような行を追加してください。
  - これにより、PR が正しく分類され、レビュープロセスがスムーズに進むことが保証されます。

### 4. Issue の継続的なトリアージ: `Scheduled Issue Triage`

これは、トリアージプロセスで Issue が見落とされないようにするためのフォールバックワークフローです。

- **ワークフローファイル**: `.github/workflows/gemini-scheduled-issue-triage.yml`
- **実行タイミング**: すべてのオープンな Issue に対して1時間ごとに実行されます。
- **機能**:
  - ラベルがまったくない Issue、または `status/need-triage` ラベルがまだ付いている Issue を積極的に探し出します。
  - その後、初期トリアージボットと同じ強力な Gemini ベースの分析をトリガーして、正しいラベルを適用します。
- **実行すべきこと**:
  - 通常、何もする必要はありません。このワークフローは、初期トリアージが失敗した場合でも、すべての Issue が最終的に分類されることを保証するためのセーフティネットです。

### 5. リリース自動化

このワークフローは、Gemini CLI の新しいバージョンのパッケージングと公開のプロセスを処理します。

- **ワークフローファイル**: `.github/workflows/release-manual.yml`
- **実行タイミング**: 「ナイトリー」リリースの場合、日次スケジュールで、公式パッチ/マイナーリリースの場合は手動で実行されます。
- **機能**:
  - プロジェクトを自動的にビルドし、バージョン番号を上げ、パッケージを npm に公開します。
  - 生成されたリリースノートとともに、GitHub に対応するリリースを作成します。
- **実行すべきこと**:
  - コントリビューターとして、このプロセスで何もする必要はありません。PR が `main` ブランチにマージされると、変更は次のナイトリーリリースに含まれることを確信できます。

この詳細な概要がお役に立てば幸いです。自動化またはプロセスについてご質問がある場合は、お気軽にお問い合わせください！